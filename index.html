<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="(loop (print (eval (read))))" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>(loop (print (eval (read))))</title><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Handlee" type="text/css"><style type="text/css">.fb-share-button , .twitter-share-button {
  vertical-align: text-bottom;
  margin-left : 5px;
}
</style><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true
  }
});</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/javascript">var switchTo5x=true;</script><script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript">stLight.options({publisher: "3df02cad-979e-4347-be4c-94fe98b99af9", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script></head><body><div id="fb-root"></div><script type="text/javascript">(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ko_KR/sdk.js#xfbml=1&appId=783844121725729&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script><header class="head"><h1 class="head-title u-fl"><a href="/">(loop (print (eval (read))))</a></h1><h4 class="sub-title u-fl">;;닭집을 차리기 위한 여정</h4><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="[object Object]" class="head-nav__link">0</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2016-08-18T18:47:09.000Z" class="post__time">8월 19, 2016</time><h1 class="post__title"> <a href="/2016/08/19/루프의-컨벤션/">루프의 컨벤션</a><div style="float:right;"><div data-href="/2016/08/19/루프의-컨벤션/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2016/08/19/루프의-컨벤션/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><p>SICP 2장을 죽 읽다보면 <code>map</code>을 이용한 리스트 조작이 나오고, 또 이를 재귀적으로 적용하여 우리가 흔히 얘기하는 이중 루프 (혹은 겹친 루프) 를 만들어 내는 예제나 연습문제가 많이 나온다.</p>
<p>은근하게도, 하나의 컨벤션이 제시되는데 바로 <code>flatmap</code> 이다.</p>
<p>아래는 바로 대표적인 예를 보여주는 연습문제 <code>n-queens problem</code> 이다.</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">n-queens</span> n)</div><div class="line">  (<span class="name"><span class="builtin-name">define</span></span> (<span class="name">iter</span> m)</div><div class="line">    (<span class="name"><span class="builtin-name">if</span></span> (<span class="name"><span class="builtin-name">zero?</span></span> m)</div><div class="line">        '(())</div><div class="line">        (<span class="name">filter</span> (<span class="name">λ</span> (<span class="name">queens</span>)</div><div class="line">                  (<span class="name"><span class="builtin-name">let*</span></span> ([<span class="name">current-queen</span> (<span class="name"><span class="builtin-name">car</span></span> queens)]</div><div class="line">                         [<span class="name">rest-queens</span> (<span class="name"><span class="builtin-name">cdr</span></span> queens)]</div><div class="line">                         [<span class="name">indexed-rest-queens</span> (<span class="name"><span class="builtin-name">map</span></span> cons rest-queens (<span class="name">range</span> <span class="number">1</span> (<span class="name"><span class="builtin-name">length</span></span> queens)))])</div><div class="line">                    (<span class="name"><span class="builtin-name">not</span></span></div><div class="line">                     (<span class="name">ormap</span> (<span class="name">λ</span> (<span class="name">indexed-queen</span>)</div><div class="line">                              (<span class="name">ormap</span> (<span class="name">λ</span> (<span class="name">current-queen-attack-range</span>)</div><div class="line">                                       (<span class="name"><span class="builtin-name">=</span></span> (<span class="name"><span class="builtin-name">car</span></span> indexed-queen) current-queen-attack-range))</div><div class="line">                                     (<span class="name"><span class="builtin-name">list</span></span> current-queen</div><div class="line">                                           (<span class="name"><span class="builtin-name">+</span></span> current-queen (<span class="name"><span class="builtin-name">cdr</span></span> indexed-queen)) <span class="comment">;; current-queen 과의 거리 +</span></div><div class="line">                                           (<span class="name"><span class="builtin-name">-</span></span> current-queen (<span class="name"><span class="builtin-name">cdr</span></span> indexed-queen))))) <span class="comment">;; current-queen 과의 거리 - </span></div><div class="line">                            indexed-rest-queens))))</div><div class="line">                (<span class="name">append-map</span> (<span class="name">λ</span> (<span class="name">result</span>)</div><div class="line">                              (<span class="name"><span class="builtin-name">map</span></span> (<span class="name">λ</span> (<span class="name">current</span>)</div><div class="line">                                     (<span class="name"><span class="builtin-name">cons</span></span> current result))</div><div class="line">                                   (<span class="name">range</span> <span class="number">1</span> (<span class="name">add1</span> n))))</div><div class="line">                            (<span class="name">iter</span> (<span class="name">sub1</span> m))))))</div><div class="line">  (<span class="name">iter</span> n))</div><div class="line">  </div><div class="line">```  </div><div class="line">&gt; `plt-racket` 에서의 `flatmap` 은 `append-map`이다.  참고로, `clojure` 에서는 `mapcat`</div><div class="line"></div><div class="line">처음 SICP 를 볼때는 아무 생각없이 `flatmap` 을 썼었는데, 사실 이 `flatmap` 이 이런 쓰임새로 활용될 때에는 머릿속에 잘 그려지지 않는다고 생각한다. 해서, `flatmap` 의 동작을 설명하는 코드를 짜 보았다.</div><div class="line"></div><div class="line">먼저 `flatmap` 은 `apply-append-map` 과 같다. 위에서 append-map 으로 시작하는 코드를 다음과 같이 바꿔도 동작할 것이다.</div><div class="line"></div><div class="line">```scheme</div><div class="line"> (<span class="name"><span class="builtin-name">apply</span></span> append</div><div class="line">	    (<span class="name"><span class="builtin-name">map</span></span></div><div class="line">	     (<span class="name">λ</span> (<span class="name">result</span>)</div><div class="line">	           (<span class="name"><span class="builtin-name">map</span></span> (<span class="name">λ</span> (<span class="name">current</span>)</div><div class="line">	                  (<span class="name"><span class="builtin-name">cons</span></span> current result))</div><div class="line">	                (<span class="name">range</span> <span class="number">1</span> (<span class="name">add1</span> n))))</div><div class="line">	         (<span class="name">iter</span> (<span class="name">sub1</span> m))))</div></pre></td></tr></table></figure>
<p>이는 사실 모든 원소에 함수롤 적용한 결과로부터 얻은 리스트들을 다시 하나의 리스트들로 <strong>모은다</strong>는 뜻이다.  따라서 <code>reduce-by-append</code> 와 같다.</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="name">foldr</span> append</div><div class="line">       '()</div><div class="line">       (<span class="name"><span class="builtin-name">map</span></span></div><div class="line">        (<span class="name">λ</span> (<span class="name">result</span>)</div><div class="line">              (<span class="name"><span class="builtin-name">map</span></span> (<span class="name">λ</span> (<span class="name">current</span>)</div><div class="line">                     (<span class="name"><span class="builtin-name">cons</span></span> current result))</div><div class="line">                   (<span class="name">range</span> <span class="number">1</span> (<span class="name">add1</span> n))))</div><div class="line">            (<span class="name">iter</span> (<span class="name">sub1</span> m))))</div></pre></td></tr></table></figure>
<p>이렇게 해놓고 나니, <code>flatmap</code> 이 어떻게 동작할 지, 머릿속에 분명하게 그려진다. 다시 <code>flatmap</code> 을 써야지.</p>
<p>요즘 SICP 스터디를 다시 하면서 요런코드들을 자바나 자바스크립트로 써보고 있는데, 특히 자바의 경우는 java8 이후로 람다와 스트림을 지원해서 어느정도 용이하게 작성하는게 가능해졌다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        System.out.println(nQueens(<span class="number">5</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; nQueens(Integer n) &#123;</div><div class="line">        <span class="keyword">return</span> nQueens(n, n);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; nQueens(Integer n, Integer m) &#123;</div><div class="line">        <span class="keyword">if</span> (m.equals(<span class="number">0</span>)) &#123;</div><div class="line">            List&lt;List&lt;Integer&gt;&gt; lst = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">            lst.add(<span class="keyword">new</span> LinkedList&lt;&gt;());</div><div class="line">            <span class="keyword">return</span> lst;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> nQueens(n, m - <span class="number">1</span>).stream()</div><div class="line">                    .flatMap(result -&gt;</div><div class="line">                                    IntStream.range(<span class="number">1</span>, n + <span class="number">1</span>)</div><div class="line">                                            .boxed()</div><div class="line">                                            .map(current -&gt; &#123;</div><div class="line">                                                List&lt;Integer&gt; lst = <span class="keyword">new</span> LinkedList&lt;&gt;(result);</div><div class="line">                                                lst.add(<span class="number">0</span>, current);</div><div class="line">                                                <span class="keyword">return</span> lst;</div><div class="line">                                            &#125;)</div><div class="line">                    )</div><div class="line">                    .filter(queens -&gt; &#123;</div><div class="line">                        <span class="keyword">int</span> currentQueen = queens.get(<span class="number">0</span>);</div><div class="line">                        </div><div class="line">                        <span class="keyword">boolean</span> isSafe = <span class="keyword">true</span>;</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; queens.size(); i++) &#123;</div><div class="line">                            Integer queen = queens.get(i);</div><div class="line">                            <span class="keyword">if</span> (currentQueen == queen ||</div><div class="line">                                    currentQueen + i == queen ||</div><div class="line">                                    currentQueen - i == queen)</div><div class="line">                                isSafe = <span class="keyword">false</span>;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> isSafe;</div><div class="line">                    &#125;)            </div><div class="line">                    .collect(Collectors.toList());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>요즘엔 자바를 쓰면서도 그다지 불편하지 않아서 참 다행이라는 생각이 든다.<br>하지만 점점 돈은 안되는 느낌이다. 슬프다..</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/flatmap/" class="post__tag__link">flatmap</a></li><li class="post__tag__item"><a href="/tags/mapcat/" class="post__tag__link">mapcat</a></li><li class="post__tag__item"><a href="/tags/append-map/" class="post__tag__link">append-map</a></li><li class="post__tag__item"><a href="/tags/sicp/" class="post__tag__link">sicp</a></li><li class="post__tag__item"><a href="/tags/nested-map/" class="post__tag__link">nested map</a></li></ul><a href="/2016/08/19/루프의-컨벤션/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2016-02-17T22:21:03.000Z" class="post__time">2월 18, 2016</time><h1 class="post__title"> <a href="/2016/02/18/Schema-SqlKorma-그리고-defmulti/">Schema , SqlKorma 그리고 defmulti</a><div style="float:right;"><div data-href="/2016/02/18/Schema-SqlKorma-그리고-defmulti/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2016/02/18/Schema-SqlKorma-그리고-defmulti/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><h2 id="타입이-쓸만한가"><a href="#타입이-쓸만한가" class="headerlink" title="타입이 쓸만한가?"></a>타입이 쓸만한가?</h2><p>예전에  c로 <code>struct</code> 같은 키워드로 타입을 구현하던 기억을 떠올려보자. 그때의 타입은 메모리의 위치를 참조하기 편하게 하기 위해 타입을 썼던것 같다.</p>
<p>뭐, 그때는 메모리는 당연히 고정되어야 하는것이고 원시타입의 크기에 따라 크기를 가늠할 수 있었기 때문이라고 생각.</p>
<p>그렇기 때문에 요즘에는, 그러니까 데이터의 사이즈가 막 변하고, 어떻게 조합될지도 예측하기 어려운 상황에서 그런용도로 타입을 쓰는 사람은 드물지 않을까?</p>
<p>오히려 다음 두 가지 이유때문에 타입을 쓰는 사람이 많을 거라 생각한다.</p>
<ul>
<li><em>문서화</em></li>
<li><em>멤버변수의 모양새 제한</em></li>
</ul>
<p>그렇다면, 동일한 가치를 제공하는 다른 개념이 있으면 타입은 안써도 되지 않을까?</p>
<h2 id="schema"><a href="#schema" class="headerlink" title="schema"></a>schema</h2><p><a href="https://github.com/plumatic/schema" target="_blank" rel="external">https://github.com/plumatic/schema</a></p>
<p>스키마의 핵심적인 역할을 하는 함수는 <code>validate</code> 이다. 요걸로 확인하고자 하는 값이 미리 정의한 스키마에 부합하는지 판별한다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">(def Data</div><div class="line">  "A schema for a nested data type"</div><div class="line">  &#123;:a &#123;:b s/Str</div><div class="line">       :c s/Int&#125;</div><div class="line">	   :d [&#123;:e s/Keyword</div><div class="line">	        :f [s/Num]&#125;]&#125;)</div><div class="line"></div><div class="line">(s/validate</div><div class="line">  Data</div><div class="line">    &#123;:a &#123;:b 123</div><div class="line">    	 :c "ABC"&#125;&#125;)</div><div class="line"></div><div class="line">;; Exception -- Value does not match schema:</div><div class="line">;;  &#123;:a &#123;:b (not (instance? java.lang.String 123)),</div><div class="line">;;       :c (not (integer? "ABC"))&#125;,</div><div class="line">;;   :d missing-required-key&#125;</div><div class="line">```			</div><div class="line"></div><div class="line">공홈의 저 예제를 보면 저 스키마의 형태가 상당히 직관적임을 알 수 있다. 물론 함수를 정의하면서 인자의 스키마를 지정할 수도 있고, 해당 함수 실행시에 인자가 스키마를 따르는지 확인 할 수도 있다.</div><div class="line"></div><div class="line">그러나 매번 `validate` 를 하기엔 귀찮으므로 이러한 스키마를 지켜야 하는 `namespace` 안에서는 기본 clojure 기능들을 override 해버리자.</div><div class="line"></div><div class="line">```clojure</div><div class="line">(ns korma-run.core</div><div class="line">  (:refer-clojure :exclude [atom fn defn defmethod letfn defrecord])</div><div class="line">  (:require [korma.core :refer :all]</div><div class="line">            [schema-tools.core :as st]</div><div class="line">            [medley.core :as md]</div><div class="line">            [schema.core :refer :all]))</div></pre></td></tr></table></figure>
<p>그리고 나서 전역 설정을 먹이면 매 함수 호출마다 스키마를 검사하게 된다.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">set-fn-validation!</span> <span class="literal">true</span>)</div></pre></td></tr></table></figure>
<p>이제 이것과 <code>SqlKorma</code> 를 엮으면 데이터베이스 조회시 조금은 더 신뢰할 수 있는 결과가 나오겠지?</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">(<span class="name">defentity</span> discounts (<span class="name">table</span> <span class="symbol">:discount</span>))</div><div class="line">(<span class="name">defschema</span> Discount</div><div class="line">  &#123;(<span class="name">optional-key</span> <span class="symbol">:id</span>) Num</div><div class="line">   (<span class="name">required-key</span> <span class="symbol">:type</span>) Str</div><div class="line">   (<span class="name">required-key</span> <span class="symbol">:sale?</span>) Bool</div><div class="line">   (<span class="name">required-key</span> <span class="symbol">:amount</span>) Num&#125;)</div><div class="line"></div><div class="line">(<span class="name">defentity</span> items (<span class="name">table</span> <span class="symbol">:item</span>))</div><div class="line">(<span class="name">defschema</span> Item</div><div class="line">  &#123;(<span class="name">optional-key</span> <span class="symbol">:id</span>) Num</div><div class="line">   (<span class="name">required-key</span> <span class="symbol">:price</span>) Num</div><div class="line">   (<span class="name">required-key</span> <span class="symbol">:name</span>) Str&#125;)</div></pre></td></tr></table></figure>
<p>이제 <code>defmulti</code> 를 써서 자바에서 주로 내 밥벌이로 쓰던 <code>mybatis</code> 의 <code>discriminator</code> 같은 기능을 훨씬 쉽고 더 좋게 쓸 수 있다.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defmulti</span></span> promote</div><div class="line">  (<span class="name"><span class="builtin-name">fn</span></span></div><div class="line">   [_</div><div class="line">    discount <span class="symbol">:-</span> Discount]</div><div class="line">   (<span class="symbol">:type</span> discount)))</div><div class="line"></div><div class="line">(<span class="name"><span class="builtin-name">defmethod</span></span> promote</div><div class="line">  <span class="string">"fixed"</span></div><div class="line">  [item <span class="symbol">:-</span> Item</div><div class="line">   discount <span class="symbol">:-</span> Discount]</div><div class="line">  (<span class="name"><span class="builtin-name">-</span></span> (<span class="symbol">:price</span> item)</div><div class="line">     (<span class="symbol">:amount</span> discount)))</div><div class="line"></div><div class="line">(<span class="name"><span class="builtin-name">defmethod</span></span> promote</div><div class="line">  <span class="string">"rate"</span></div><div class="line">  [item <span class="symbol">:-</span> Item</div><div class="line">   discount <span class="symbol">:-</span> Discount]</div><div class="line">  (<span class="name"><span class="builtin-name">*</span></span> (<span class="symbol">:price</span> item)</div><div class="line">     (<span class="name"><span class="builtin-name">-</span></span> <span class="number">1</span> (<span class="symbol">:amount</span> discount))))</div></pre></td></tr></table></figure>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/clojure/" class="post__tag__link">clojure</a></li><li class="post__tag__item"><a href="/tags/schema/" class="post__tag__link">schema</a></li><li class="post__tag__item"><a href="/tags/sqlkorma/" class="post__tag__link">sqlkorma</a></li><li class="post__tag__item"><a href="/tags/defmulti/" class="post__tag__link">defmulti</a></li></ul><a href="/2016/02/18/Schema-SqlKorma-그리고-defmulti/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2016-01-30T15:31:31.000Z" class="post__time">1월 31, 2016</time><h1 class="post__title"> <a href="/2016/01/31/회사걱정/">회사걱정</a><div style="float:right;"><div data-href="/2016/01/31/회사걱정/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2016/01/31/회사걱정/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><blockquote>
<p>입사한지 약 3개월쯤 안되어 받은 설문 조사에서 답변한 글.</p>
</blockquote>
<p>갑작스레 이런 메일을 받게되어 놀랐습니다;</p>
<p>입사한지 얼마 안되어 이런 질문에 답변을 드리는것이 외람되다고 여겨집니다.<br>때문에 짧은의견, 사실과 거리가 먼 소견을 말하게 되더라도 양해 부탁드립니다..</p>
<p>사실 저는 불만인 점을 몇몇 이유를 들어 말씀드리고 싶습니다.</p>
<p>첫째는 회사의 분위기가 기술중심의 회사로는 사실 느껴지지 않습니다.<br>직급이 없다고하나 팀의 프로젝트를 사실상 정하는 사람들이 있고 이 사람들의 기술적 고려가 부족한듯 합니다.</p>
<p>둘째는 프로젝트 팀 그 자체입니다.<br>좋은 팀을 만드는 것의 가치가 훼손되고 있다고 느껴집니다.<br>프로젝트 팀의 구성이 바뀌거나 혹은 구성원이 원하지 않는 팀 구성, 프로젝트 진행중 간섭 등이 없었으면 좋겠습니다..</p>
<p>그리고 마지막으로,<br><s>XX</s> 프로젝트의 기안 및 추진하는 과정에서 의사결정의 실패가 있었다고 생각하고 있습니다.<br>제가 불만을 가질만한 영역은 아닙니다만 회사가 잘못된 의사결정을 하게되면 결국 다른 모든 영역들로 영향을 미칠 것이므로..<br>걱정스럽게 생각하고 있습니다..</p>
<p>이상은 제가 입사전의 내역을 몰라서 적은 글일수도 있습니다. 그렇다면 바로잡아 주시면 감사하겠습니다.</p>
<p>기한에 늦은데다가 또 늦은 새벽에 메일을보내 죄송합니다 ㅎ;; 이만 줄이겠습니다.</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/회사/" class="post__tag__link">회사</a></li><li class="post__tag__item"><a href="/tags/퇴사/" class="post__tag__link">퇴사</a></li><li class="post__tag__item"><a href="/tags/의견/" class="post__tag__link">의견</a></li></ul><a href="/2016/01/31/회사걱정/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-10-25T16:14:04.000Z" class="post__time">10월 26, 2015</time><h1 class="post__title"> <a href="/2015/10/26/Spring-aop-example/">Spring aop example</a><div style="float:right;"><div data-href="/2015/10/26/Spring-aop-example/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2015/10/26/Spring-aop-example/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><h3 id="guice가-참-좋은데-정말-좋은데"><a href="#guice가-참-좋은데-정말-좋은데" class="headerlink" title="guice가 참 좋은데.. 정말 좋은데"></a>guice가 참 좋은데.. 정말 좋은데</h3><p>이런 어노테이션이 있다고 하자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Target</span>(ElementType.METHOD)</div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Authorized &#123;</div><div class="line">    <span class="function">Type <span class="title">to</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="keyword">enum</span> Type &#123;</div><div class="line">        PUBLIC, ADMIN</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>이런 쥬스 모듈에 의해 바인딩되고,</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizeModule</span> <span class="keyword">extends</span> <span class="title">AbstractModule</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">()</span> </span>&#123;</div><div class="line">        AuthorizeInterceptor authorizeInterceptor = <span class="keyword">new</span> AuthorizeInterceptor();</div><div class="line">        requestInjection(authorizeInterceptor);</div><div class="line">        bindInterceptor(Matchers.inSubpackage(<span class="string">"com.foo.example"</span>), Matchers.any(), authorizeInterceptor);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>이런 인터셉터를 호출한다 ㅎㅎ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizeInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(AuthorizeInterceptor.class);</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">       Authorized authorized = invocation.getMethod().getAnnotation(Authorized.class);</div><div class="line">        <span class="keyword">if</span>(authorized != <span class="keyword">null</span> &amp;&amp; authorized.to() == Authorized.Type.PUBLIC)</div><div class="line">            <span class="keyword">return</span> invocation.proceed();</div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">FIXME:</span> authorize! and delete below line.</span></div><div class="line">        logger.info(<span class="string">"authorizing . . . "</span>);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> invocation.proceed();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>놀랍게도, 이게 다다. 아오.. 너무 좋다..</p>
<p>하지만 쥬스는 돈이 안 된다. 따라서 이걸 스프링으로 해 보자.</p>
<h3 id="스프링에서의-aop"><a href="#스프링에서의-aop" class="headerlink" title="스프링에서의 aop"></a>스프링에서의 aop</h3><p>먼저 <code>advice</code> 를 만든다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooAdvice</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(FooAdvice.class);</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        LOGGER.warn(<span class="string">"Capitalism, ho!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>그 다음 <code>pointcut</code> 을 만든다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function">Pointcut <span class="title">pointcut</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ComposablePointcut().union(</div><div class="line">            clazz -&gt; clazz.getPackage().getName().equals(<span class="string">"com.foo.example.controller"</span>) &amp;&amp;</div><div class="line">                    clazz.getAnnotation(Controller.class) != <span class="keyword">null</span></div><div class="line">    ).intersection(</div><div class="line">            <span class="keyword">new</span> AnnotationMethodMatcher(FooAnnotation.class)</div><div class="line">    );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>위에서 <code>ComposablePointcut</code> 이 쥬스에서 하던 바인딩과 유사하여 꽤나 쓸만하다. jdk8 과 만나 드디어 사람이 읽을 수 있는 표현이 되었다!!</p>
<p>다음 <code>pointcut advisor</code> 를 만든다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function">PointcutAdvisor <span class="title">pointcutAdvisor</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultPointcutAdvisor(pointcut(),advice());</div><div class="line">    &#125;</div><div class="line">```				</div><div class="line"></div><div class="line">위에서 만든 `pointcut` , `adivce` , `pointcut advisor` 는 반드시 다음 `DefaultAdvisorAutoProxyCreator` 를 통해야만 프록시가 생성된다.</div><div class="line"></div><div class="line">```java</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function">DefaultAdvisorAutoProxyCreator <span class="title">defaultAdvisorAutoProxyCreator</span><span class="params">()</span></span>&#123;</div><div class="line">        DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator = <span class="keyword">new</span> DefaultAdvisorAutoProxyCreator();</div><div class="line">        defaultAdvisorAutoProxyCreator.setProxyTargetClass(<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">return</span> defaultAdvisorAutoProxyCreator;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>이렇게 하면 쥬스로 했던거랑 딱히 다를것도 없다. 우왕!</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/spring/" class="post__tag__link">spring</a></li><li class="post__tag__item"><a href="/tags/java/" class="post__tag__link">java</a></li><li class="post__tag__item"><a href="/tags/aop/" class="post__tag__link">aop</a></li><li class="post__tag__item"><a href="/tags/example/" class="post__tag__link">example</a></li><li class="post__tag__item"><a href="/tags/guice/" class="post__tag__link">guice</a></li></ul><a href="/2015/10/26/Spring-aop-example/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-10-05T07:30:17.000Z" class="post__time">10월 5, 2015</time><h1 class="post__title"> <a href="/2015/10/05/클로져-스마트폰-2/">클로져 + 스마트폰(2)</a><div style="float:right;"><div data-href="/2015/10/05/클로져-스마트폰-2/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2015/10/05/클로져-스마트폰-2/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><h1 id="clojure-스마트폰-lt-3"><a href="#clojure-스마트폰-lt-3" class="headerlink" title="clojure + 스마트폰 = &lt;3"></a>clojure + 스마트폰 = &lt;3</h1><h2 id="lein-설정및-noir-웹-프로젝트-생성하기"><a href="#lein-설정및-noir-웹-프로젝트-생성하기" class="headerlink" title="lein 설정및 noir 웹 프로젝트 생성하기"></a>lein 설정및 noir 웹 프로젝트 생성하기</h2><p><code>~/.lein/profiles.clj</code> 를 편집한다.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="symbol">:user</span> &#123;<span class="symbol">:plugins</span> [[cider/cider-nrepl <span class="string">"0.10.0-SNAPSHOT"</span>]</div><div class="line">                  [lein-localrepo <span class="string">"0.5.2"</span>]</div><div class="line">				  [noir <span class="string">"1.3.0"</span>]]</div><div class="line">	    <span class="symbol">:dependencies</span> [[org.clojure/tools.nrepl <span class="string">"0.2.7"</span>]]&#125;&#125;</div></pre></td></tr></table></figure>
<p>다음 프로젝트 폴더 (예를들어 <code>~/Project</code> ) 에 방문하여 다음을 입력하여 <code>noir</code> 프로젝트를 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ lein new noir foo-web</div></pre></td></tr></table></figure>
<p>디펜던시들을 다운받고 다음의 메시지가 출력되며 프로젝트가 생성된다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Generating a lovely new Noir project named foo-web...</div></pre></td></tr></table></figure>
<p><code>emacs</code> 로 다음의 파일을 연다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">emacs ~/Project/foo-web/project.clj</div></pre></td></tr></table></figure>
<p><code>:dependencies</code> 중 <code>clojure</code> 정도만 <code>1.7.0</code> 정도로 바꿔준다..</p>
<p><kbd>C-c, M-j</kbd> 로 <code>clojure-jack-in</code> 함수를 호출한다. 좀 오래 기다리면 <code>REPL</code> 버퍼가 열린다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CIDER 0.10.0snapshot (package: 20150901.1605) (Java 1.8.0_45, Clojure 1.7.0, nREPL 0.2.7)</div><div class="line">foo-web.server&gt;</div></pre></td></tr></table></figure>
<p><kbd>C-c, C-z</kbd> 를 눌러 <code>project.clj</code> 버퍼가 열리도록 한 뒤에,</p>
<p><kbd>C-x, C-f</kbd> 를 눌러 <code>~/Project/foo-web/src/foo_web/server.clj</code> 파일을 연다.</p>
<p><kbd>C-c, C-k</kbd> 를 눌러 컴파일한다.</p>
<p><kbd>C-c, C-z</kbd> 를 눌러 <code>REPL</code> 버퍼로 다시 이동한다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">foo-web.server&gt; (def srv (-main))</div><div class="line">Starting server...</div><div class="line">Server started on port [8080].</div><div class="line">You can view the site at http://localhost:8080</div><div class="line">#'foo-web.server/srv</div><div class="line">foo-web.server&gt;</div></pre></td></tr></table></figure>
<p>이것으로 최초로 서버를 기동했다. aws ip 에 8080 포트로 접근해보자.</p>
<h2 id="웹-페이지-만들기"><a href="#웹-페이지-만들기" class="headerlink" title="웹 페이지 만들기"></a>웹 페이지 만들기</h2><p><code>src/foo_web/views/welcome.clj</code> 파일을 연다.</p>
<p><kbd>C-c, M-n</kbd> 를 눌러서 <code>REPL</code> 버퍼의 <code>namespace</code> 를  현재 열린 버퍼의 <code>namespace</code> 로 전환한다.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">ns</span></span> foo-web.views.welcome</div><div class="line">  (<span class="symbol">:require</span> [foo-web.views.common <span class="symbol">:as</span> common]</div><div class="line">              [noir.content.getting-started])</div><div class="line">			    (<span class="symbol">:use</span> [noir.core <span class="symbol">:only</span> [defpage]]))</div><div class="line"></div><div class="line">(<span class="name">defpage</span> <span class="string">"/welcome"</span> []</div><div class="line">         (<span class="name">common/layout</span></div><div class="line">		            [<span class="symbol">:p</span> <span class="string">"Welcome to foo-web"</span>]))</div></pre></td></tr></table></figure>
<p><code>defpage</code> 매크로로 선언된 부분을 보면 이후 따라오는 주소로 다음과 같은 html 을 렌더링했음을 알 수 있다.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome to foo-web<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>html5</code> 매크로에 의해 <code>[:p]</code> 는 <code>hiccup</code> 이라는 라이브러리의 <code>hiccup.core/html</code> 매크로를 호출하여 html로 치환된다. 다음의 표현이 가능하다</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">foo-web.views.welcome&gt; (println (hiccup.core/html [:h1.foo-class  "bar"]))</div><div class="line">;; &lt;h1 class="foo-class"&gt;bar&lt;/h1&gt;</div><div class="line">;; =&gt; nil</div><div class="line">foo-web.views.welcome&gt; (println (hiccup.core/html [:h1#an-id.foo-class  "bar"]))</div><div class="line">;; &lt;h1 class="foo-class" id="an-id"&gt;bar&lt;/h1&gt;</div><div class="line">;; =&gt; nil</div><div class="line">foo-web.views.welcome&gt; (println (hiccup.core/html [:div [:h1#an-id.foo-class  "bar"]]))</div><div class="line">;; &lt;div&gt;&lt;h1 class="foo-class" id="an-id"&gt;bar&lt;/h1&gt;&lt;/div&gt;</div><div class="line">;; =&gt; nil</div><div class="line">foo-web.views.welcome&gt;</div></pre></td></tr></table></figure>
<p>다음과 같은 페이지를 만들어 보자.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(<span class="name">defpage</span> <span class="string">"/foo"</span> []</div><div class="line">  (<span class="name">common/layout</span></div><div class="line">    [<span class="symbol">:div.wrapper</span></div><div class="line">	  [<span class="symbol">:input</span> &#123;<span class="symbol">:type</span> <span class="string">"text"</span>&#125;]</div><div class="line">	  [<span class="symbol">:button</span> <span class="string">"OK"</span>]</div><div class="line">	  ]))</div></pre></td></tr></table></figure>
<p><code>common/layout</code> 이란 매크로를 주목하자. 여기에 커서를 위치시킨뒤 <kbd>M-.</kbd> 를 이용하여 이동할 수 있다.</p>
<p><code>defpartial</code> 매크로는 결국 <code>hiccup</code> 매크로로 작성된 블럭들을 조립할 수 있음을 알 수 있다.</p>
<p>따라서 좀더 활용가능하도록 바꿔보자.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">(<span class="name">defpartial</span> layout [ &amp; &#123;<span class="symbol">:keys</span> [style</div><div class="line">                               script</div><div class="line">                               header</div><div class="line">                               content</div><div class="line">                               footer]&#125;]</div><div class="line">  (<span class="name">html5</span></div><div class="line">   [<span class="symbol">:head</span></div><div class="line">    [<span class="symbol">:title</span> <span class="string">"Macadamia!"</span>]</div><div class="line">    `(~@script)]</div><div class="line">   [<span class="symbol">:body</span></div><div class="line">    [<span class="symbol">:div#header</span> `(~@header)]</div><div class="line">    [<span class="symbol">:div#wrapper</span> </div><div class="line">     [<span class="symbol">:div#content</span> `(~@content)]]</div><div class="line">    [<span class="symbol">:div#footer</span> `(~@footer)]</div><div class="line">    ]))</div></pre></td></tr></table></figure>
<p><code>foo</code> 페이지는 다음과 같이 변경한다.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(<span class="name">defpage</span> <span class="string">"/foo"</span> []</div><div class="line">  (<span class="name">common/layout</span></div><div class="line">   <span class="symbol">:content</span></div><div class="line">   [[<span class="symbol">:div.wrapper</span></div><div class="line">    [<span class="symbol">:input</span> &#123;<span class="symbol">:type</span> <span class="string">"text"</span>&#125;]</div><div class="line">	[<span class="symbol">:button</span> <span class="string">"OK"</span>]</div><div class="line">	]]))</div></pre></td></tr></table></figure>
<p>이렇게 해서 템플릿 레이아웃을 쓸 수 있게 되었다.</p>
<p>이제 이 템플릿 레이아웃에 <code>bootstrap</code> 을 적용하도록 하자.</p>
<p><code>css</code>,<code>js</code> 등 정적파일은 <code>resources/public/</code> 에 추가하면 된다. 여기서는 그냥 cdn을 이용하는것으로.</p>
<p><code>common.clj</code> 의 <code>:use</code> 함수에 <code>include-js</code> 를 추가하고 <code>layout</code> 을 수정하자.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">ns</span></span> my-website.views.common</div><div class="line">  (<span class="symbol">:use</span> [noir.core <span class="symbol">:only</span> [defpartial]]</div><div class="line">        [hiccup.page <span class="symbol">:only</span> [include-css include-js html5]]))</div><div class="line">		</div><div class="line">(<span class="name">defpartial</span> layout [ &amp; &#123;<span class="symbol">:keys</span> [style</div><div class="line">                               script</div><div class="line">                               header</div><div class="line">                               content</div><div class="line">                               footer]&#125;]</div><div class="line">  (<span class="name">html5</span></div><div class="line">   [<span class="symbol">:head</span></div><div class="line">    [<span class="symbol">:title</span> <span class="string">"Macadamia!"</span>]</div><div class="line">	(<span class="name">include-css</span> <span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"</span>)</div><div class="line">	(<span class="name">include-js</span> <span class="string">"//code.jquery.com/jquery-1.11.3.min.js"</span>)</div><div class="line">    `(~@script)]</div><div class="line">   [<span class="symbol">:body</span></div><div class="line">    [<span class="symbol">:div#header</span> `(~@header)]</div><div class="line">    [<span class="symbol">:div#wrapper.container</span> &#123;<span class="symbol">:style</span> <span class="string">"display: table; height: 100vh;"</span>&#125;</div><div class="line">     [<span class="symbol">:div#content</span> &#123;<span class="symbol">:style</span> <span class="string">"display: table-cell; vertical-align: middle;"</span>&#125; `(~@content)]]</div><div class="line">    [<span class="symbol">:div#footer</span> `(~@footer)]</div><div class="line">	(<span class="name">include-js</span> <span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"</span>)	</div><div class="line">    ]))</div></pre></td></tr></table></figure>
<p>자 이제 <code>bootstrap</code> 으로 스타일링을 하자.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">(<span class="name">defpage</span> <span class="string">"/foo"</span> []</div><div class="line">  (<span class="name">common/layout</span></div><div class="line">   <span class="symbol">:content</span></div><div class="line">   [[<span class="symbol">:div.col-md-12</span></div><div class="line">     [<span class="symbol">:div.row.col-md-6.col-md-offset-3</span></div><div class="line">	  [<span class="symbol">:div.input-group</span></div><div class="line">	   [<span class="symbol">:input.form-control</span> &#123;<span class="symbol">:type</span> <span class="string">"text"</span>&#125;]</div><div class="line">	   [<span class="symbol">:span.input-group-btn</span></div><div class="line">		[<span class="symbol">:button.btn.btn-primary</span> <span class="string">"OK"</span>]]]]]]))</div></pre></td></tr></table></figure>
<p>잘 나온다. ㅎㅎ</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/clojure/" class="post__tag__link">clojure</a></li><li class="post__tag__item"><a href="/tags/smartphone/" class="post__tag__link">smartphone</a></li><li class="post__tag__item"><a href="/tags/iphone/" class="post__tag__link">iphone</a></li></ul><a href="/2015/10/05/클로져-스마트폰-2/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-10-03T12:49:51.000Z" class="post__time">10월 3, 2015</time><h1 class="post__title"> <a href="/2015/10/03/클로져-스마트폰/">클로져 + 스마트폰(1)</a><div style="float:right;"><div data-href="/2015/10/03/클로져-스마트폰/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2015/10/03/클로져-스마트폰/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><h1 id="clojure-스마트폰-lt-3"><a href="#clojure-스마트폰-lt-3" class="headerlink" title="clojure + 스마트폰 = &lt;3"></a>clojure + 스마트폰 = &lt;3</h1><h2 id="보기전에"><a href="#보기전에" class="headerlink" title="보기전에"></a>보기전에</h2><p>스스로를 생각하면 나는 웹사이트나 통신서버등 고만고만한 걸 개발하며 먹고살고는 있지만 <strong><em>개발자</em></strong>는 아니지 않나 하고 생각하게 됨.</p>
<p>애초에 전공도 아니고 로우레벨에 (회로나 어셈같은) 대한 지식도 전무하며 무엇보다 주위 개발자들이 좋아하는 서버응답속도 개선이나 나 코드 줄여쓰기 같은 욕구가 거의 없음..</p>
<p>따라서 이 글도 <strong>장난감</strong>만들기라는 본연의 목적에만 충실할 뿐 근저에 깔린 <em>사상</em>이나 <em>작동원리</em>는 나도 모르거나 생략할 거라는..</p>
<p>또한 이 장난감은 1년쯤 전부터 해오던거라 지금의 트렌드와는 많이 다른 <strong>legacy</strong> 들이 많이 나오므로 진지한 개발자는 안 읽으시는것이 좋겠다. 실제로 좋은말을 들어본적이 없다.</p>
<p>차라리 개발을 전혀 모르는 사람이 보는것이 더 좋겠지않나..</p>
<h2 id="AWS-에-가입하기"><a href="#AWS-에-가입하기" class="headerlink" title="AWS 에 가입하기"></a>AWS 에 가입하기</h2><p><a href="https://aws.amazon.com" target="_blank" rel="external">https://aws.amazon.com</a> 열루 가서…<br><img src="/2015/10/03/클로져-스마트폰/aws_join.png" alt="aws_join.png" title=""></p>
<blockquote>
<p>개발자라면 AWS 계정이 없는것이 이상할정도로<br>거의 무제한 공짜(1년간 마이크로 인스턴스 무료. 그러나 메일계정만 있으면 계속 생성가능)<br>이지만 그래도 아직 가입하지 않았다면 가입하는것이 좋다.</p>
</blockquote>
<p>가입중 신용카드 정보를 입력하는 부분이 등장한다. 외화결제가 가능해야 하므로 준비해놓아야 한다.<br><img src="/2015/10/03/클로져-스마트폰/aws_join2.png" alt="aws_join2.png" title=""></p>
<p>가입하고 tokyo 리젼 콘솔로 접근해서 ec 인스턴스를 생성하고 pem 파일을 다운로드 받아 놓는다. 이때 <strong>free tier eligible</strong>을 선택해야 공짜가 됨. 공짜 조건은 micro 급 ec 인스턴스 한개이므로 다른 스토리지, rds, 로드밸런서 따위를 선택해서도 안된다.</p>
<img src="/2015/10/03/클로져-스마트폰/aws_main.png" alt="aws_main.png" title="">
<img src="/2015/10/03/클로져-스마트폰/aws_ec_launch_create.png" alt="aws_ec_launch_create.png" title="">
<img src="/2015/10/03/클로져-스마트폰/aws_ec_launch_ami.png" alt="aws_ec_launch_ami.png" title="">
<img src="/2015/10/03/클로져-스마트폰/aws_ec_launch_instance_type.png" alt="aws_ec_launch_instance_type.png" title="">
<img src="/2015/10/03/클로져-스마트폰/aws_ec_launch_tag.png" alt="aws_ec_launch_tag.png" title="">
<img src="/2015/10/03/클로져-스마트폰/aws_ec_launch_security.png" alt="aws_ec_launch_security.png" title="">
<img src="/2015/10/03/클로져-스마트폰/aws_ec_launch_done.png" alt="aws_ec_launch_done.png" title="">
<p>해당키로 ssh로 접근해보면 잘 된다. ㅎㅎ</p>
<h2 id="스마트폰-용-ssh-클라이언트-다운받기"><a href="#스마트폰-용-ssh-클라이언트-다운받기" class="headerlink" title="스마트폰 용 ssh 클라이언트 다운받기"></a>스마트폰 용 ssh 클라이언트 다운받기</h2><p>나는 <a href="https://serverauditor.com" target="_blank" rel="external">https://serverauditor.com</a> 라는 앱을 씀.</p>
<p>다운받고 설정을 해야한다.</p>
<img src="/2015/10/03/클로져-스마트폰/server_auditor_menu.png" alt="server_auditor_menu.png" title="">
<img src="/2015/10/03/클로져-스마트폰/server_auditor_add_key.png" alt="server_auditor_add_key.png" title="">
<img src="/2015/10/03/클로져-스마트폰/server_auditor_add_key_2.png" alt="server_auditor_add_key_2.png" title="">
<img src="/2015/10/03/클로져-스마트폰/server_auditor_add_key_3.png" alt="server_auditor_add_key_3.png" title="">
<img src="/2015/10/03/클로져-스마트폰/server_auditor_add_identity.png" alt="server_auditor_add_identity.png" title="">
<img src="/2015/10/03/클로져-스마트폰/server_auditor_add_host.png" alt="server_auditor_add_host.png" title="">
<img src="/2015/10/03/클로져-스마트폰/server_auditor_done.png" alt="server_auditor_done.png" title="">
<p>잘된다. ㅎㅎ</p>
<h2 id="필요한-환경-구축하기"><a href="#필요한-환경-구축하기" class="headerlink" title="필요한 환경 구축하기"></a>필요한 환경 구축하기</h2><p>먼저 <code>zsh</code> 를 설치하자.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install git</div><div class="line">sudo apt-get install zsh</div><div class="line">sudo curl -L http://install.ohmyz.sh | sh</div><div class="line">sudo chsh <span class="_">-s</span> $(<span class="built_in">which</span> zsh) ubuntu</div></pre></td></tr></table></figure>
<blockquote>
<p>중간에 zsh 이 에러를 내는데 걍 쉘 변경하다 나는 에러니까 무시하고 다음 라인 입력하면 된다.</p>
</blockquote>
<p><code>tmux</code> 로 세션을 만들어 둔다. 이렇게 만든 세션은 항상 살려둔 채로 끄지 않을 예정이다.</p>
<p><kbd>C-b s</kbd>로 <code>tmux</code>세션을 선택할 수 있고 <kbd>C-b $</kbd>로 이름을 바꿀수 있다. <code>clojure</code> 정도로 이름을 바꾸자. 세션 하나를 더 추가하여 관리용으로 써도 좋다.</p>
<p>자바와 이맥스를 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo add-apt-repository ppa:openjdk-r/ppa</div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install openjdk-8-jdk</div><div class="line">sudo apt-get install emacs</div></pre></td></tr></table></figure>
<p>lein 을 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein</div><div class="line">sudo chmod 755 lein</div><div class="line">./lein</div><div class="line">cp lein ~/bin</div></pre></td></tr></table></figure>
<p><code>$PATH</code> 에 위치해야 하므로 <code>.zshrc</code> 파일을 편집하여 <code>~/bin</code>이 <code>$PATH</code>에 포함되도록 한다.</p>
<p><a href="https://melpa.org/#/getting-started" target="_blank" rel="external">https://melpa.org/#/getting-started</a> 여기에 방문해서 제시하는 내용을 <code>~/.emacs.d/init.el</code> 파일을 생성하고 붙여넣는다.</p>
<p>emacs를 실행하자.</p>
<p><kbd>M-x</kbd> 후 <code>package-list-packages</code>를 입력하여 필요한 패키지를 다운받는다.</p>
<ul>
<li><code>clojure-mode</code></li>
<li><code>cider</code></li>
<li><code>auto-complete</code></li>
<li><code>ac-cider</code></li>
<li><code>golden-ratio</code></li>
</ul>
<p>해당 패키지 로 커서를 옮겨서(<kbd>C-p, C-n, C-v, M-v</kbd>) <kbd>i</kbd> 키로 선택 <kbd>x</kbd>키를 눌러 설치한다.</p>
<p><code>init.el</code> 파일에 <code>ac-cider</code> 관련 설정을 추가해준다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">(require &apos;ac-cider)</div><div class="line">(add-hook &apos;cider-mode-hook &apos;ac-flyspell-workaround)</div><div class="line">(add-hook &apos;cider-mode-hook &apos;ac-cider-setup)</div><div class="line">(add-hook &apos;cider-repl-mode-hook &apos;ac-cider-setup)</div><div class="line">(eval-after-load &quot;auto-complete&quot;</div><div class="line">  &apos;(progn</div><div class="line">       (add-to-list &apos;ac-modes &apos;cider-mode)</div><div class="line">	        (add-to-list &apos;ac-modes &apos;cider-repl-mode)))</div><div class="line"></div><div class="line">(defun set-auto-complete-as-completion-at-point-function ()</div><div class="line">  (setq completion-at-point-functions &apos;(auto-complete)))</div><div class="line"></div><div class="line">(add-hook &apos;auto-complete-mode-hook &apos;set-auto-complete-as-completion-at-point-function)</div><div class="line">(add-hook &apos;cider-mode-hook &apos;set-auto-complete-as-completion-at-point-function)</div></pre></td></tr></table></figure>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/clojure/" class="post__tag__link">clojure</a></li><li class="post__tag__item"><a href="/tags/smartphone/" class="post__tag__link">smartphone</a></li><li class="post__tag__item"><a href="/tags/iphone/" class="post__tag__link">iphone</a></li></ul><a href="/2015/10/03/클로져-스마트폰/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-07-29T14:21:48.000Z" class="post__time">7월 29, 2015</time><h1 class="post__title"> <a href="/2015/07/29/왜-프로젝트가-망할까/">왜 프로젝트가 망할까?</a><div style="float:right;"><div data-href="/2015/07/29/왜-프로젝트가-망할까/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2015/07/29/왜-프로젝트가-망할까/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><p>빙 둘러 말하기로 프로젝트 위키에다가 써 보았다.<br>물론 프로젝트 위키에다가 썼으므로 팀원만 보겠지 ㅎㅎ…</p>
<hr>
<h3 id="스크럼-이걸-왜-하나요"><a href="#스크럼-이걸-왜-하나요" class="headerlink" title="스크럼 이걸 왜 하나요?"></a>스크럼 이걸 왜 하나요?</h3><blockquote>
<p>원활한 개발을 방해하는 요소들은 셀 수 없이 많습니다. 하지만, 그런 방해 요소들을 적극적으로 해결하고자 하는 노력은 그에 비해 턱없이 부족합니다. 늦어지는 기획, 너무 잦은 회의, 본부장의 잦은 간섭, 협업 요청에 대한 동료의 무응답, 작업을 더디게하는 수많은 요소들은 오늘도 우리 주위에 산재해 있습니다. 하지만, 이런 것들에 문제를 제기하면 왠지 분위기가 어색해질 것 같고 눈치가 보여서 포기하고 맙니다. 결국 시간이 갈수록 즐겁게 개발 할 수 있는 환경은 사라져갑니다. 스크럼은 목표를 달성하는데 방해가 되는 요소들을 그 즉시 해결해야 한다고 이야기합니다.</p>
</blockquote>
<ul>
<li><a href="http://resoneit.blogspot.kr/2012/10/blog-post_30.html" target="_blank" rel="external">http://resoneit.blogspot.kr/2012/10/blog-post_30.html</a></li>
<li>현재 상황에서 우리 mcc-backoffice 개발팀은 온전한 프로젝트 매니징을 기대할 수 없는 상황 (내가 대충 땜빵하고 있지만.. @yh.jang )</li>
<li>또한 언제나 그렇듯이 깊은 이해가 없는 방법론 도입은 그다지 효과가 없다.</li>
<li>따라서 앞서 인용한 <code>개발저해요소</code> 를 제거하는 데 촛점을 맞추고 나머지를 천천히 도입해야 할 것.<ul>
<li>프로젝트 팀이 아닌이상 프로젝트에 관여할 수 없어야 한다.<ul>
<li>누구라도 프로젝트에 관여하려면, 팀의 일원이 되어야 한다.</li>
<li>팀의 일원이 되었으면, 협업 방법을 익히고 커뮤니케이션 하라.</li>
<li>협업 방법을 익혔으면, 자신이 하는 일을 기록하고 그 일을 책임져라.</li>
</ul>
</li>
<li>프로젝트 리더가 프로젝트 팀을 구성한다.<ul>
<li>생각보다 협업은 어렵고 팀은 성장할 시간이 필요하다.</li>
<li>모든 프로젝트는 팀의 성장도에 따라 다른 퍼포먼스를 보일 것이다.</li>
</ul>
</li>
<li>스프린트가 끝나기 전에 제품 사양이 변경되는 경우가 없어야 한다.<ul>
<li>제품이 나오기 전에, 제품의 유효성은 알 수 없다.</li>
<li>프로젝트 팀은 매 스프린트 마다 피드백 가능한 <code>작동하는</code> 프로토타입을 만드는것을 목표로 한다.</li>
<li>제품 사양 변경은 프로토타입을 검토하고 나서 해도 절대 늦지 않다.</li>
</ul>
</li>
<li>프로젝트의 모든 부분이 테스트 가능한 상태를 유지해야 한다<ul>
<li>급격한 사양변경 혹은 제품 기반이 변경되었을때 이를 견디게 해주는 필수요소다.</li>
<li>급격한 변경에도 견딜수 있으므로 파괴적인 구조개선을 통해 단순하고 견고한 체제를 구축하는것이 가능.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/팀/" class="post__tag__link">팀</a></li><li class="post__tag__item"><a href="/tags/프로젝트/" class="post__tag__link">프로젝트</a></li><li class="post__tag__item"><a href="/tags/스크럼/" class="post__tag__link">스크럼</a></li><li class="post__tag__item"><a href="/tags/저해요소/" class="post__tag__link">저해요소</a></li></ul><a href="/2015/07/29/왜-프로젝트가-망할까/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-03-16T17:52:41.000Z" class="post__time">3월 17, 2015</time><h1 class="post__title"> <a href="/2015/03/17/warless-webapp/">warless webapp 전략</a><div style="float:right;"><div data-href="/2015/03/17/warless-webapp/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2015/03/17/warless-webapp/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><p><s>이런 접근이 나온지도 벌써 수년이 흘렀고, 몇년동안 써먹고 있는 방법이긴하지만 새삼스럽게 공개하자면</s></p>
<p><a href="http://www.jamesward.com/2011/08/23/war-less-java-web-apps" target="_blank" rel="external">http://www.jamesward.com/2011/08/23/war-less-java-web-apps</a> 여기에 아주 잘 정리 되어 있다.</p>
<p>요점은, embedded jetty 를 통해 main 메서드를 통해 ide 로도 실행할 수 있고, excutable jar 를 생성하여 실행할 수 도 있는 프로젝트를 구성하는 것.</p>
<p>이 접근은 언뜻 생각하기에도 벌써 장점이 여럿 보인다.</p>
<ul>
<li>ide를 통한 실행은 별도로 컴파일 하지 않아도 된다 (incremental compile)</li>
<li>또한 웹 리소스 파일들은 main 메서드에 의해 직접 참조되므로 복사할 필요가 없다.</li>
<li>따라서 프로젝트 초기라면 (또 어느정도 규모가 있지 않다면) 웹어플리케이션을 정지하고 재구동하는데 5초 미만의 시간이 걸리게 된다.</li>
</ul>
<p>좀 더 작고 기민하게, 수수하지만 실용적인 방법으로 개발하고자 할 때 알맞겠다.</p>
<blockquote>
<p>jetty는 사실 고민할 필요도 없이 좋은 was다.<br><a href="https://wiki.eclipse.org/Jetty/Feature/Continuations" target="_blank" rel="external">https://wiki.eclipse.org/Jetty/Feature/Continuations</a></p>
<p>물론 가장 기민한 것은 clojure 다.<br>이미 jetty를 쓰고 있기도 하고..<br>하지만 clojure 는 돈이 안되므로.</p>
</blockquote>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/jetty/" class="post__tag__link">jetty</a></li><li class="post__tag__item"><a href="/tags/warless/" class="post__tag__link">warless</a></li><li class="post__tag__item"><a href="/tags/webapp/" class="post__tag__link">webapp</a></li></ul><a href="/2015/03/17/warless-webapp/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-03-14T10:57:41.000Z" class="post__time">3월 14, 2015</time><h1 class="post__title"> <a href="/2015/03/14/마이바티스-쓰기/">마이바티스 활용하기</a><div style="float:right;"><div data-href="/2015/03/14/마이바티스-쓰기/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2015/03/14/마이바티스-쓰기/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><h3 id="매핑하기"><a href="#매핑하기" class="headerlink" title="매핑하기."></a>매핑하기.</h3><p>사실, 모든 내용은 마이바티스 공홈에 다 있다. 그런데 흔히 잘 안보고 지나치는 기능 두개에 대해서 얘기해보려고 한다.<br>columnPrefix 와 discrimantor 가 그것이다.</p>
<p>이들을 써서 맵핑하는 방법이다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"exp.model.Post"</span> <span class="attr">id</span>=<span class="string">"Post"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"ID"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"NAME"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"TITLE"</span> <span class="attr">property</span>=<span class="string">"title"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"CONTENT"</span> <span class="attr">property</span>=<span class="string">"content"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"author"</span> <span class="attr">columnPrefix</span>=<span class="string">"USR_"</span> <span class="attr">resultMap</span>=<span class="string">"exp.repo.UserMapper.User"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">"exp.var.PostType"</span> <span class="attr">column</span>=<span class="string">"type"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">"PUBLIC"</span> <span class="attr">resultType</span>=<span class="string">"exp.model.PublicPost"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">"PRIVATE"</span> <span class="attr">resultType</span>=<span class="string">"exp.model.PrivatePost"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>association</code> 엘리먼트에 걸린 내용을 잘 보면 <code>columnPrefix</code> 어트리뷰트에 <code>USR_</code> 이라고 명시하고 다른 결과맵으로 맵핑하도록 해놓았다.<br>그리고 <code>discriminator</code> 에 <code>javaType</code> 으로 <code>enum</code> 타입을 적시하고 어떤 타입으로 맵핑할 것인지 정한다. 물론 <code>Post</code>의 하위 타입이다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"select"</span> <span class="attr">resultMap</span>=<span class="string">"Post"</span>&gt;</span></div><div class="line">&lt;![CDATA[</div><div class="line">    SELECT</div><div class="line">	    post.ID,</div><div class="line">		post.TYPE,</div><div class="line">		post.TITLE,</div><div class="line">		post.CONTENT,</div><div class="line">		usr.ID AS USR_ID,</div><div class="line">		usr.TYPE AS USR_TYPE,</div><div class="line">		usr.NAME AS USR_NAME,</div><div class="line">		usr.AGE AS USR_AGE</div><div class="line">	FROM</div><div class="line">	    post</div><div class="line">	JOIN</div><div class="line">	    USR ON post.USR_ID = USR.ID</div><div class="line">]]&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="columnPrefix"><a href="#columnPrefix" class="headerlink" title="columnPrefix"></a>columnPrefix</h3><p>테이블명과 자바클래스명을 일치시킨다면, <code>comlumnPrefix</code>를 이용해서 모든 alias 를 멤버명과 동일하게 일치시킬 수 있다. 예를들어,<br><code>Post</code> 클래스에 <code>comments</code> 필드가 있다면 <code>columnPrefix</code>를 <code>COMMENTS_</code> 로 주고 collection 으로 매핑하면 된다.<br>(나는 이를 위해서라도 테이블명에 복수형을 붙이지 않는다. 테이블명을 복수형으로 붙이는건 (예를들어 users, posts..) 간지난다는거 빼고 좋은게 없는듯.</p>
<p>더 좋은것은 이 <code>columnPrefix</code> 가 선언된 하위 <code>resultMap</code> 은 재귀적으로 적용된다는 것. 예를들어 <code>COMMENTS_AUTHOR_ID</code> 같은 alias를 해석할수 있다는 것.</p>
<p>하지만 이 방법은 캐쉬를 적용하기에 좋지 않다.</p>
<h3 id="discriminator"><a href="#discriminator" class="headerlink" title="discriminator"></a>discriminator</h3><p><code>Post</code> 클래스는 어쩔 수 없이 abstract 클래스여서는 안된다.<br>그런 제약이 있기는 해도, select 한 번으로 각 하위타입으로 매핑해서  (또한 재귀적으로) 조회할 수 있다는건 큰 매력이다.<br>참고로 이렇게 조회한 <code>Post</code> 의 리스트는 <code>google-guava</code> 라이브러리의 <code>filter</code> 메서드같은 함수형 접근과 아주 궁합이 잘 맞는다.</p>
<p>일전에 언급했던 템플릿 패턴과 같이 쓰면 표현력이 대폭 상승하게 된다.</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/mybatis/" class="post__tag__link">mybatis</a></li><li class="post__tag__item"><a href="/tags/마이바티스/" class="post__tag__link">마이바티스</a></li><li class="post__tag__item"><a href="/tags/columnPrefix/" class="post__tag__link">columnPrefix</a></li><li class="post__tag__item"><a href="/tags/discriminator/" class="post__tag__link">discriminator</a></li></ul><a href="/2015/03/14/마이바티스-쓰기/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-03-14T09:36:42.000Z" class="post__time">3월 14, 2015</time><h1 class="post__title"> <a href="/2015/03/14/realy-need-service-layer/">서비스 레이어가 *정말로* 필요한가?</a><div style="float:right;"><div data-href="/2015/03/14/realy-need-service-layer/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2015/03/14/realy-need-service-layer/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><h3 id="간단하게-할-수-있으면-간단하게-해라"><a href="#간단하게-할-수-있으면-간단하게-해라" class="headerlink" title="간단하게 할 수 있으면 간단하게 해라."></a>간단하게 할 수 있으면 간단하게 해라.</h3><p>맞지 않나? 간단히 할 수 있는일을 왜 안 간단하게 하는지 모르겠다.<br>무슨 디커플링 어쩌구 하는데, 단 한번 쓰일 메서드 내지는 다음에 쓰일지 말지 애매한 메서드까지 왜 서비스 레이어 위에 올리는걸까?<br>왜 소스코드를 늘리고 더 복잡하게 만드는걸까? 이해가 안된다.<br>간단히 Authentication 만 봐도 그렇다. 인증 과정이 여러 포인트에서 지금 당장 일어나고 있다면 모를까, 최초 코드 작성시점에서 벌써 그런 사정을 고려할 필요는 없다.<br>이게 스프링 커뮤니티에서 추천하는 jdk프록시와 만나 impl 서비스 레이어를 만드는 것으로 더 복잡해진다.</p>
<blockquote>
<p><code>LoginController</code> -&gt; <code>LoginService</code> -&gt; <code>LoginServiceImpl</code> -&gt; <code>UserDao</code> -&gt; UserMapper</p>
</blockquote>
<p>컨트롤러에 비즈니스 로직을 집어넣는것이 나쁘다 (내지는 바람직하지 않다) 고 하는게 널리 알려진 말이지만,<br>지금껏 경험한 바로는 그런 말이 이해가 안될정도로, 그저 똑같은 메서드를 가진 서비스 클래스를 하나 더 만들뿐이다.</p>
<p>어떤 개념을 하나 더 두는것이 아무리 일정한 컨벤션을 가지고 있고 나중에 쓸모가 <strong>있을지도 모른다</strong> 할지라도 가장 좋은건 그냥 없는게 가장 좋지 않나?</p>
<p>예를들면 인증은 그냥 이런 코드로도 충분하지 않나 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RootController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Resource</span>(name = <span class="string">"session"</span>)</div><div class="line">    Session session;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    UserMapper userMapper;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    PostMapper postMapper;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    FooService fooService;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">root</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (session.getUser() == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="string">"redirect:/page/hello"</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> <span class="string">"redirect:/page/home"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Authorized</span>(to = Type.PUBLIC)</div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/page/hello"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"/jsp/hello.jsp"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/page/home"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">home</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;Post&gt; posts = postMapper.select();</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"/jsp/home.jsp"</span>).addObject(<span class="string">"posts"</span>, posts);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Authorized</span>(to = Type.PUBLIC)</div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/proc/login"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(</span></span></div><div class="line">        @RequestParam(required = <span class="keyword">true</span>) String name,</div><div class="line">        @<span class="title">RequestParam</span><span class="params">(required = <span class="keyword">true</span>)</span> String password</div><div class="line">    ) &#123;</div><div class="line">        User user = userMapper.selectByLogin(name, password);</div><div class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchUserException();</div><div class="line"></div><div class="line">        session.setUser(user);</div><div class="line">        <span class="keyword">return</span> <span class="string">"redirect:/"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/proc/logout"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span> </span>&#123;</div><div class="line">        session.setUser(<span class="keyword">null</span>);</div><div class="line">        <span class="keyword">return</span> <span class="string">"redirect:/"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/service/" class="post__tag__link">service</a></li><li class="post__tag__item"><a href="/tags/layer/" class="post__tag__link">layer</a></li><li class="post__tag__item"><a href="/tags/mvc/" class="post__tag__link">mvc</a></li></ul><a href="/2015/03/14/realy-need-service-layer/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2016 euhyen ~_~</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><a title="Next" href="/page/2/" class="page-menu__link icon-arrow-right"></a></li></menu></footer><script>(function(h,g,l,k,j,i){j=h.createElement(g),i=h.getElementsByTagName(g)[0],
j.src="//"+l+".disqus.com/"+k+".js",i.parentNode.insertBefore(j,i)})
(document,"script","ehjanghexo","count");
</script></body></html>