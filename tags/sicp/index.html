<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="(loop (print (eval (read))))" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>sicp - (loop (print (eval (read))))</title><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Handlee" type="text/css"><style type="text/css">.fb-share-button , .twitter-share-button {
  vertical-align: text-bottom;
  margin-left : 5px;
}
</style><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true
  }
});</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/javascript">var switchTo5x=true;</script><script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript">stLight.options({publisher: "3df02cad-979e-4347-be4c-94fe98b99af9", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script></head><body><div id="fb-root"></div><script type="text/javascript">(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ko_KR/sdk.js#xfbml=1&appId=783844121725729&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script><header class="head"><h1 class="head-title u-fl"><a href="/">(loop (print (eval (read))))</a></h1><h4 class="sub-title u-fl">;;닭집을 차리기 위한 여정</h4><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="[object Object]" class="head-nav__link">0</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2016-08-18T18:47:09.000Z" class="post__time">8월 19, 2016</time><h1 class="post__title"> <a href="/2016/08/19/루프의-컨벤션/">루프의 컨벤션</a><div style="float:right;"><div data-href="/2016/08/19/루프의-컨벤션/" data-layout="button_count" class="fb-share-button"></div><a href="https://twitter.com/share" data-url="http://zerosumz.github.io/2016/08/19/루프의-컨벤션/" data-via="k_racketeer" class="twitter-share-button"></a></div></h1></header><div class="post__main echo"><p>SICP 2장을 죽 읽다보면 <code>map</code>을 이용한 리스트 조작이 나오고, 또 이를 재귀적으로 적용하여 우리가 흔히 얘기하는 이중 루프 (혹은 겹친 루프) 를 만들어 내는 예제나 연습문제가 많이 나온다.</p>
<p>은근하게도, 하나의 컨벤션이 제시되는데 바로 <code>flatmap</code> 이다.</p>
<p>아래는 바로 대표적인 예를 보여주는 연습문제 <code>n-queens problem</code> 이다.</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">n-queens</span> n)</div><div class="line">  (<span class="name"><span class="builtin-name">define</span></span> (<span class="name">iter</span> m)</div><div class="line">    (<span class="name"><span class="builtin-name">if</span></span> (<span class="name"><span class="builtin-name">zero?</span></span> m)</div><div class="line">        '(())</div><div class="line">        (<span class="name">filter</span> (<span class="name">λ</span> (<span class="name">queens</span>)</div><div class="line">                  (<span class="name"><span class="builtin-name">let*</span></span> ([<span class="name">current-queen</span> (<span class="name"><span class="builtin-name">car</span></span> queens)]</div><div class="line">                         [<span class="name">rest-queens</span> (<span class="name"><span class="builtin-name">cdr</span></span> queens)]</div><div class="line">                         [<span class="name">indexed-rest-queens</span> (<span class="name"><span class="builtin-name">map</span></span> cons rest-queens (<span class="name">range</span> <span class="number">1</span> (<span class="name"><span class="builtin-name">length</span></span> queens)))])</div><div class="line">                    (<span class="name"><span class="builtin-name">not</span></span></div><div class="line">                     (<span class="name">ormap</span> (<span class="name">λ</span> (<span class="name">indexed-queen</span>)</div><div class="line">                              (<span class="name">ormap</span> (<span class="name">λ</span> (<span class="name">current-queen-attack-range</span>)</div><div class="line">                                       (<span class="name"><span class="builtin-name">=</span></span> (<span class="name"><span class="builtin-name">car</span></span> indexed-queen) current-queen-attack-range))</div><div class="line">                                     (<span class="name"><span class="builtin-name">list</span></span> current-queen</div><div class="line">                                           (<span class="name"><span class="builtin-name">+</span></span> current-queen (<span class="name"><span class="builtin-name">cdr</span></span> indexed-queen)) <span class="comment">;; current-queen 과의 거리 +</span></div><div class="line">                                           (<span class="name"><span class="builtin-name">-</span></span> current-queen (<span class="name"><span class="builtin-name">cdr</span></span> indexed-queen))))) <span class="comment">;; current-queen 과의 거리 - </span></div><div class="line">                            indexed-rest-queens))))</div><div class="line">                (<span class="name">append-map</span> (<span class="name">λ</span> (<span class="name">result</span>)</div><div class="line">                              (<span class="name"><span class="builtin-name">map</span></span> (<span class="name">λ</span> (<span class="name">current</span>)</div><div class="line">                                     (<span class="name"><span class="builtin-name">cons</span></span> current result))</div><div class="line">                                   (<span class="name">range</span> <span class="number">1</span> (<span class="name">add1</span> n))))</div><div class="line">                            (<span class="name">iter</span> (<span class="name">sub1</span> m))))))</div><div class="line">  (<span class="name">iter</span> n))</div><div class="line">  </div><div class="line">```  </div><div class="line">&gt; `plt-racket` 에서의 `flatmap` 은 `append-map`이다.  참고로, `clojure` 에서는 `mapcat`</div><div class="line"></div><div class="line">처음 SICP 를 볼때는 아무 생각없이 `flatmap` 을 썼었는데, 사실 이 `flatmap` 이 이런 쓰임새로 활용될 때에는 머릿속에 잘 그려지지 않는다고 생각한다. 해서, `flatmap` 의 동작을 설명하는 코드를 짜 보았다.</div><div class="line"></div><div class="line">먼저 `flatmap` 은 `apply-append-map` 과 같다. 위에서 append-map 으로 시작하는 코드를 다음과 같이 바꿔도 동작할 것이다.</div><div class="line"></div><div class="line">```scheme</div><div class="line"> (<span class="name"><span class="builtin-name">apply</span></span> append</div><div class="line">	    (<span class="name"><span class="builtin-name">map</span></span></div><div class="line">	     (<span class="name">λ</span> (<span class="name">result</span>)</div><div class="line">	           (<span class="name"><span class="builtin-name">map</span></span> (<span class="name">λ</span> (<span class="name">current</span>)</div><div class="line">	                  (<span class="name"><span class="builtin-name">cons</span></span> current result))</div><div class="line">	                (<span class="name">range</span> <span class="number">1</span> (<span class="name">add1</span> n))))</div><div class="line">	         (<span class="name">iter</span> (<span class="name">sub1</span> m))))</div></pre></td></tr></table></figure>
<p>이는 사실 모든 원소에 함수롤 적용한 결과로부터 얻은 리스트들을 다시 하나의 리스트들로 <strong>모은다</strong>는 뜻이다.  따라서 <code>reduce-by-append</code> 와 같다.</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="name">foldr</span> append</div><div class="line">       '()</div><div class="line">       (<span class="name"><span class="builtin-name">map</span></span></div><div class="line">        (<span class="name">λ</span> (<span class="name">result</span>)</div><div class="line">              (<span class="name"><span class="builtin-name">map</span></span> (<span class="name">λ</span> (<span class="name">current</span>)</div><div class="line">                     (<span class="name"><span class="builtin-name">cons</span></span> current result))</div><div class="line">                   (<span class="name">range</span> <span class="number">1</span> (<span class="name">add1</span> n))))</div><div class="line">            (<span class="name">iter</span> (<span class="name">sub1</span> m))))</div></pre></td></tr></table></figure>
<p>이렇게 해놓고 나니, <code>flatmap</code> 이 어떻게 동작할 지, 머릿속에 분명하게 그려진다. 다시 <code>flatmap</code> 을 써야지.</p>
<p>요즘 SICP 스터디를 다시 하면서 요런코드들을 자바나 자바스크립트로 써보고 있는데, 특히 자바의 경우는 java8 이후로 람다와 스트림을 지원해서 어느정도 용이하게 작성하는게 가능해졌다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        System.out.println(nQueens(<span class="number">5</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; nQueens(Integer n) &#123;</div><div class="line">        <span class="keyword">return</span> nQueens(n, n);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; nQueens(Integer n, Integer m) &#123;</div><div class="line">        <span class="keyword">if</span> (m.equals(<span class="number">0</span>)) &#123;</div><div class="line">            List&lt;List&lt;Integer&gt;&gt; lst = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">            lst.add(<span class="keyword">new</span> LinkedList&lt;&gt;());</div><div class="line">            <span class="keyword">return</span> lst;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> nQueens(n, m - <span class="number">1</span>).stream()</div><div class="line">                    .flatMap(result -&gt;</div><div class="line">                                    IntStream.range(<span class="number">1</span>, n + <span class="number">1</span>)</div><div class="line">                                            .boxed()</div><div class="line">                                            .map(current -&gt; &#123;</div><div class="line">                                                List&lt;Integer&gt; lst = <span class="keyword">new</span> LinkedList&lt;&gt;(result);</div><div class="line">                                                lst.add(<span class="number">0</span>, current);</div><div class="line">                                                <span class="keyword">return</span> lst;</div><div class="line">                                            &#125;)</div><div class="line">                    )</div><div class="line">                    .filter(queens -&gt; &#123;</div><div class="line">                        <span class="keyword">int</span> currentQueen = queens.get(<span class="number">0</span>);</div><div class="line">                        </div><div class="line">                        <span class="keyword">boolean</span> isSafe = <span class="keyword">true</span>;</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; queens.size(); i++) &#123;</div><div class="line">                            Integer queen = queens.get(i);</div><div class="line">                            <span class="keyword">if</span> (currentQueen == queen ||</div><div class="line">                                    currentQueen + i == queen ||</div><div class="line">                                    currentQueen - i == queen)</div><div class="line">                                isSafe = <span class="keyword">false</span>;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> isSafe;</div><div class="line">                    &#125;)            </div><div class="line">                    .collect(Collectors.toList());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>요즘엔 자바를 쓰면서도 그다지 불편하지 않아서 참 다행이라는 생각이 든다.<br>하지만 점점 돈은 안되는 느낌이다. 슬프다..</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/flatmap/" class="post__tag__link">flatmap</a></li><li class="post__tag__item"><a href="/tags/mapcat/" class="post__tag__link">mapcat</a></li><li class="post__tag__item"><a href="/tags/append-map/" class="post__tag__link">append-map</a></li><li class="post__tag__item"><a href="/tags/sicp/" class="post__tag__link">sicp</a></li><li class="post__tag__item"><a href="/tags/nested-map/" class="post__tag__link">nested map</a></li></ul><a href="/2016/08/19/루프의-컨벤션/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2016 euhyen ~_~</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><span title="Next" class="page-menu__link icon-arrow-right page-menu__link--disabled"></span></li></menu></footer><script>(function(h,g,l,k,j,i){j=h.createElement(g),i=h.getElementsByTagName(g)[0],
j.src="//"+l+".disqus.com/"+k+".js",i.parentNode.insertBefore(j,i)})
(document,"script","ehjanghexo","count");
</script></body></html>